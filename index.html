<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#B9E2C8" />
<title>Y-Diet: Pulses Comparison ‚Äî Single File</title>
<link rel="preload" as="image" href="./ydiet-banner.png" />
<style>
  :root{
    --bg:#ffffff; --ink:#0F172A; --muted:#64748B;
    --panel:#ffffff; --line:#E2E8F0; --hover:#F8FAFC;
    --shadow:0 10px 30px rgba(0,0,0,.08);
    --brand-green:#B9E2C8; --brand-gold:#C8A84E; --brand-maroon:#7A1E1E; --brand-mint:#DFF3E6;
  }
  [data-theme="dark"]{
    --bg:#0b0f14; --ink:#E5EDF7; --muted:#9AA7BC;
    --panel:#0f1622; --line:#1f2a39; --hover:#0d1420;
    --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
    background:var(--bg); color:var(--ink); -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    scroll-behavior:smooth;
  }
  .container{max-width:1120px;margin:0 auto;padding:16px}

  /* Header */
  .banner{position:relative;isolation:isolate}
  .banner::before{content:"";position:absolute;inset:0;z-index:-1;opacity:.30;background:
    radial-gradient(800px 300px at top left, var(--brand-green), transparent),
    radial-gradient(600px 300px at bottom right, var(--brand-gold), transparent);
  }

  /* Hero banner image */
  .hero{margin:12px 0 14px;border-radius:16px;overflow:hidden;border:1px solid var(--line);box-shadow:var(--shadow);background:var(--panel)}
  .hero img{display:block;width:100%;height:auto}
  @media print {.hero{box-shadow:none;border-color:#ccc}}

  h1{margin:6px 0 0;font-size:clamp(22px,5.2vw,36px);line-height:1.15}
  .sub{color:var(--muted)}
  .pills{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .pill{padding:6px 10px;border-radius:999px;font-size:12px;font-weight:600;white-space:nowrap}
  .pill.green{background:color-mix(in srgb, var(--brand-green) 25%, transparent); color:#0b5131;border:1px solid color-mix(in srgb, var(--brand-green) 55%, transparent)}
  .pill.gold{background:color-mix(in srgb, var(--brand-gold) 20%, transparent); color:#5e4b0e;border:1px solid color-mix(in srgb, var(--brand-gold) 50%, transparent)}
  .pill.maroon{background:color-mix(in srgb, var(--brand-maroon) 15%, transparent); color:#4c0f0f;border:1px solid color-mix(in srgb, var(--brand-maroon) 45%, transparent)}

  /* Product cards */
  .cards{display:grid;gap:14px;grid-template-columns:repeat(3,1fr);margin:18px 0}
  @media (max-width:900px){.cards{grid-template-columns:1fr}}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow)}
  .card .head{padding:14px 16px;border-bottom:1px solid var(--line)}
  .card .body{padding:14px 16px}
  .card h3{margin:0;font-size:16px}
  .emoji{font-size:22px;margin-right:8px}
  .subtitle{font-size:12px;color:var(--muted)}

  /* Tabs */
  .tabs{display:grid;gap:8px}
  .tab-list{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;position:sticky;top:0;background:var(--bg);padding-top:8px;z-index:5}
  /* Mobile: horizontal scroll for tabs */
  @media (max-width:640px){
    .tab-list{display:flex;overflow-x:auto;-webkit-overflow-scrolling:touch;gap:8px;padding-bottom:4px}
    .tab-list::-webkit-scrollbar{display:none}
  }
  .tab-list button{
    padding:12px;border-radius:12px;border:1px solid var(--line);background:var(--panel);cursor:pointer;font-weight:600;
    min-height:44px; touch-action:manipulation; -webkit-tap-highlight-color:transparent;
  }
  .tab-list button[aria-selected="true"]{outline:2px solid var(--brand-gold);}
  .tab-panel{display:none}
  .tab-panel.active{display:block}

  /* Controls */
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  .btn{padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:var(--panel);cursor:pointer;min-height:44px}
  .btn.primary{border-color:color-mix(in srgb, var(--brand-green) 40%, var(--line)); background:linear-gradient(180deg, color-mix(in srgb, var(--brand-green) 18%, #fff), var(--panel))}
  .btn:active{transform:scale(.985)}
  .btn:hover{background:var(--hover)}
  .spacer{flex:1}
  .input{background:var(--panel);border:1px solid var(--line);padding:10px 12px;border-radius:10px;min-width:240px;color:inherit}

  /* Table */
  .table-wrap{overflow:auto;-webkit-overflow-scrolling:touch}
  table{width:100%;border-collapse:separate;border-spacing:0}
  thead th{position:sticky;top:0;background:var(--panel);z-index:1}
  th,td{padding:12px 10px;border-bottom:1px solid var(--line);vertical-align:top;white-space:normal}
  tbody tr:hover{background:var(--hover)}
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid; font-weight:700;font-size:12px}

  /* Grid helpers */
  .grid{display:grid;gap:12px}
  .grid-2{grid-template-columns:repeat(2,1fr)}
  @media (max-width:900px){.grid-2{grid-template-columns:1fr}}

  /* Sliders */
  .weight-row{display:grid;grid-template-columns:140px 1fr 64px;gap:8px;align-items:center}
  input[type="range"]{width:100%}

  /* Progress */
  .bar{height:8px;background:var(--line);border-radius:8px;overflow:hidden}
  .bar > span{display:block;height:100%}

  /* Notes */
  .notes{padding:12px 16px;border:1px dashed var(--line);border-radius:12px;background:var(--hover);color:var(--ink)}

  .footer{margin:18px 0 36px;color:var(--muted);text-align:center;font-size:12px}

  /* MOBILE TUNING */
  @media (max-width:640px){
    .container{padding:12px}
    h1{font-size:clamp(20px,6vw,28px)}
    .toolbar .btn{flex:1 1 calc(50% - 8px)}
    .input{min-width:0;width:100%}
    .weight-row{grid-template-columns:1fr;gap:6px}
    table{font-size:14px}
  }
  @media (prefers-reduced-motion:reduce){
    *{animation:none!important;transition:none!important}
  }
</style>
</head>
<body>
  <div class="container">
    <!-- Banner -->
    <section class="banner">
      <!-- HERO IMAGE (local file in the same folder) -->
      <figure class="hero">
        <img
          src="./ydiet-banner.png"
          srcset="./ydiet-banner.png 1120w, ./ydiet-banner.png 1600w"
          sizes="(max-width:680px) 100vw, 1120px"
          alt="Y-Diet banner ‚Äî Raw, Sprouted, Boiled Sprouted moong with Y-leaf logo"
          width="1600" height="700" loading="eager" decoding="async" fetchpriority="high">
      </figure>

      <h1>Y-Diet: Pulses Comparison</h1>
      <p class="sub">Raw vs Sprouted vs Boiled Sprouted ‚Äî interactive, visual, and printable. Assume <strong>moong/mung</strong> unless noted.</p>
      <div class="pills">
        <span class="pill green">Clean-Label</span>
        <span class="pill gold">Synergy-First</span>
        <span class="pill maroon">Feel Light</span>
      </div>
      <div class="toolbar" style="margin-top:12px">
        <button id="printBtn" class="btn">üñ®Ô∏è Print</button>
        <button id="csvBtn" class="btn">‚¨áÔ∏è Export CSV</button>
        <span class="spacer"></span>
        <button id="themeBtn" class="btn">üåô Dark mode</button>
      </div>
    </section>

    <!-- Product Cards -->
    <section class="cards" id="productCards"></section>

    <!-- Tabs -->
    <section class="tabs">
      <div class="tab-list" role="tablist">
        <button class="tab-btn" role="tab" aria-selected="true" data-tab="visualize">Visualize</button>
        <button class="tab-btn" role="tab" aria-selected="false" data-tab="table">Table</button>
        <button class="tab-btn" role="tab" aria-selected="false" data-tab="rank">Your Ranking</button>
      </div>

      <!-- Visualize Panel -->
      <div id="panel-visualize" class="tab-panel active">
        <div class="grid grid-2" style="margin-top:12px">
          <div class="card">
            <div class="head"><h3 style="margin:0">Radar: Overall Profile</h3></div>
            <div class="body"><canvas id="radar"></canvas></div>
          </div>
          <div class="card">
            <div class="head"><h3 style="margin:0">Bars: Aspect-by-Aspect</h3></div>
            <div class="body"><canvas id="bars"></canvas></div>
          </div>
        </div>
        <div class="notes" style="margin-top:12px">
          <strong>Notes & Tips:</strong>
          <ul>
            <li>For most people, <strong>boiled sprouted moong</strong> ‚Üí least gas, most lightness, best taste.</li>
            <li>Reduce gas further with <strong>ginger, asafoetida (hing), cumin, lemon</strong>, and thorough rinsing.</li>
            <li><strong>Safety:</strong> Avoid eating raw kidney beans/soy/black gram; cook thoroughly. Keep sprouting gear clean and refrigerate sprouts; use within <strong>1‚Äì2 days</strong>.</li>
          </ul>
        </div>
      </div>

      <!-- Table Panel -->
      <div id="panel-table" class="tab-panel">
        <div class="card" style="margin-top:12px">
          <div class="head" style="display:flex;gap:8px;align-items:center">
            <h3 style="margin:0">Comparative Table</h3>
            <span class="spacer"></span>
            <input id="filterInput" class="input" placeholder="Filter aspects‚Ä¶"/>
          </div>
          <div class="body table-wrap">
            <table id="compTable"></table>
          </div>
        </div>
        <div class="notes" style="margin-top:12px">
          Scores are on a 1‚Äì5 scale for visualization; higher is better. Labels like ‚ÄúLower = Better‚Äù are pre-inverted.
        </div>
      </div>

      <!-- Rank Panel -->
      <div id="panel-rank" class="tab-panel">
        <div class="card" style="margin-top:12px">
          <div class="head"><h3 style="margin:0">Custom Ranking</h3></div>
          <div class="body grid" id="weightsPanel"></div>
        </div>
        <div class="card" style="margin-top:12px">
          <div class="head"><h3 style="margin:0">Your Results</h3></div>
          <div class="body grid" id="rankResults"></div>
        </div>
        <div class="notes" style="margin-top:12px">
          Adjust the sliders. Scores are auto-normalized by the total weight.
        </div>
      </div>
    </section>

    <div class="footer">¬© <span id="year"></span> Y-Diet ‚Ä¢ Observe ‚Üí Adjust ‚Üí Absorb ‚Üí Evolve</div>
  </div>

  <!-- Chart.js (CDN). If offline, the charts won't render; page still works. -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
  // ===== Data =====
  const brand = { green:'#B9E2C8', gold:'#C8A84E', maroon:'#7A1E1E', ink:'#0F172A', mint:'#DFF3E6' };
  const PRODUCTS = [
    { key:'raw', name:'Raw Pulses', subtitle:'dry/soaked, uncooked', color:brand.maroon, emoji:'üå±' },
    { key:'sprouted', name:'Sprouted Pulses', subtitle:'uncooked sprouts', color:brand.gold, emoji:'üåø' },
    { key:'boiled', name:'Boiled Sprouted Pulses', subtitle:'lightly cooked sprouts', color:brand.green, emoji:'üç≤' },
  ];
  const METRICS = [
    { id:'lightness', label:'Digestibility / Lightness', desc:{raw:'Low (hard on gut)', sprouted:'Medium‚ÄìHigh', boiled:'High (gentle)'}, scores:{raw:1, sprouted:4, boiled:5}},
    { id:'gas', label:'Comfort (Lower Gas = Better)', desc:{raw:'High gas ‚Üí low comfort', sprouted:'Medium gas', boiled:'Low gas ‚Üí high comfort'}, scores:{raw:1, sprouted:3, boiled:5}},
    { id:'taste', label:'Taste Satisfaction', desc:{raw:'Beany, chewy', sprouted:'Fresh, crunchy, grassy', boiled:'Warm, soft, mildly sweet‚Äìnutty'}, scores:{raw:2, sprouted:3.5, boiled:4.5}},
    { id:'antiNutrients', label:'Anti-Nutrients (Lower = Better)', desc:{raw:'Highest', sprouted:'Lower', boiled:'Lowest'}, scores:{raw:1, sprouted:3, boiled:5}},
    { id:'bioavailability', label:'Protein & Mineral Bioavailability', desc:{raw:'Lowest', sprouted:'Improved', boiled:'Best among three'}, scores:{raw:1.5, sprouted:3.5, boiled:5}},
    { id:'vitamins', label:'Vitamins / Enzymes', desc:{raw:'Baseline', sprouted:'‚Üë Some vitamins & enzymes', boiled:'Some heat loss; access still better'}, scores:{raw:2, sprouted:4, boiled:3.5}},
    { id:'glycemic', label:'Glycemic Impact (Lower = Better)', desc:{raw:'Moderate', sprouted:'Lower vs raw', boiled:'Lower‚Äìmoderate'}, scores:{raw:3, sprouted:4, boiled:3.5}},
    { id:'safety', label:'Food-Safety Confidence', desc:{raw:'Higher risk if eaten raw', sprouted:'Needs clean sprouting', boiled:'Safest when cooked'}, scores:{raw:1.5, sprouted:3, boiled:5}},
    { id:'shelf', label:'Shelf Life After Prep', desc:{raw:'Soaked < 24h chilled', sprouted:'1‚Äì2 days chilled (rinse daily)', boiled:'1‚Äì2 days chilled'}, scores:{raw:2, sprouted:3, boiled:3}},
  ];

  // ===== Helpers =====
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  $('#year').textContent = new Date().getFullYear();

  // ===== Theme: default LIGHT; respect saved choice only =====
  const themeBtn = $('#themeBtn');
  const saved = localStorage.getItem('ydiet-theme'); // 'true' for dark, 'false' for light
  let dark = saved !== null ? saved === 'true' : false; // default to LIGHT
  function setTheme(){
    document.documentElement.setAttribute('data-theme', dark ? 'dark' : 'light');
    themeBtn.textContent = dark ? '‚òÄÔ∏è Light mode' : 'üåô Dark mode';
    localStorage.setItem('ydiet-theme', String(dark));
    if(window.myCharts) window.myCharts.forEach(c=>c && c.destroy && c.destroy());
    drawCharts();
  }
  themeBtn.addEventListener('click', ()=>{ dark = !dark; setTheme(); });
  setTheme();

  // Product cards
  $('#productCards').innerHTML = PRODUCTS.map(p=>`
    <div class="card">
      <div class="head"><h3><span class="emoji" aria-hidden="true">${p.emoji}</span><span style="color:${p.color}">${p.name}</span></h3></div>
      <div class="body"><span class="subtitle">${p.subtitle}</span></div>
    </div>
  `).join('');

  // Tabs
  const tabs = $$('.tab-btn');
  function showTab(key){
    tabs.forEach(b=>b.setAttribute('aria-selected', String(b.dataset.tab===key)));
    $$('.tab-panel').forEach(p=>p.classList.toggle('active', p.id === `panel-${key}`));
  }
  tabs.forEach(b=>b.addEventListener('click', ()=>showTab(b.dataset.tab)));

  // Table
  const compTable = $('#compTable');
  function renderTable(filter=''){
    const head = `
      <thead>
        <tr>
          <th>Aspect</th>
          ${PRODUCTS.map(p=>`<th style="color:${p.color}">${p.name}</th>`).join('')}
        </tr>
      </thead>`;
    const rows = METRICS
      .filter(m=> m.label.toLowerCase().includes(filter.toLowerCase()))
      .map((m,i)=>{
        return `<tr class="${i%2? 'alt':''}">
          <td><strong>${m.label}</strong></td>
          ${PRODUCTS.map(p=>{
            const val = m.scores[p.key];
            const color = p.color;
            return `<td>
              <span class="badge" style="border-color:${color}; color:${color}">${val}</span>
              <span style="margin-left:8px;color:var(--muted)">${m.desc[p.key]}</span>
            </td>`;
          }).join('')}
        </tr>`;
      }).join('');
    compTable.innerHTML = head + `<tbody>${rows}</tbody>`;
  }
  renderTable('');
  $('#filterInput')?.addEventListener('input', e=>renderTable(e.target.value));

  // CSV export (visible rows only)
  function toCSV(){
    const rows = Array.from(compTable.querySelectorAll('tr'));
    return rows.map(r=> Array.from(r.children).map(c=> '"'+c.innerText.replaceAll('\n',' ').replaceAll('"','""')+'"').join(',')).join('\n');
  }
  $('#csvBtn').addEventListener('click', ()=>{
    const csv = toCSV();
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='pulses_comparison_moong.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });
  $('#printBtn').addEventListener('click', ()=>window.print());

  // Ranking weights panel
  const weightDefaults = { lightness:.4, gas:.3, taste:.2, safety:.1 };
  let weights = {...weightDefaults};
  const weightsPanel = $('#weightsPanel');
  const sliders = [
    { id:'lightness', label:'Weight: Lightness' },
    { id:'gas', label:'Weight: Comfort (Low Gas)' },
    { id:'taste', label:'Weight: Taste' },
    { id:'safety', label:'Weight: Food-Safety' },
  ];
  function renderWeights(){
    weightsPanel.innerHTML = sliders.map(s=>{
      const pct = Math.round((weights[s.id]||0)*100);
      return `<div class="weight-row">
        <label for="w_${s.id}">${s.label}</label>
        <input type="range" min="0" max="100" step="1" id="w_${s.id}" value="${pct}" />
        <div style="text-align:right;color:var(--muted)">${pct}%</div>
      </div>`;
    }).join('') + `<div style="color:var(--muted);font-size:12px">Total: ${(Object.values(weights).reduce((a,b)=>a+b,0)*100).toFixed(0)}% (auto-normalized)</div>`;

    sliders.forEach(s=>{
      const el = document.getElementById('w_'+s.id);
      el.addEventListener('input', (e)=>{ weights[s.id] = +e.target.value/100; renderWeights(); renderRanking(); });
    });
  }
  renderWeights();

  // Ranking computation
  const rankResults = $('#rankResults');
  function renderRanking(){
    const sumW = Object.values(weights).reduce((a,b)=>a+b,0) || 1;
    const list = PRODUCTS.map(p=>{
      const score = METRICS.reduce((acc,m)=>{ const w = weights[m.id] || 0; return acc + (m.scores[p.key]*w); },0) / sumW;
      return { key:p.key, name:p.name, color:p.color, score: +score.toFixed(2) };
    }).sort((a,b)=>b.score-a.score);

    rankResults.innerHTML = list.map((r,i)=>{
      const pct = (r.score/5)*100;
      return `<div class="card">
        <div class="head" style="display:flex;align-items:center;justify-content:space-between"><strong>${i+1}. ${r.name}</strong><span class="badge" style="border-color:${r.color}; color:${r.color}">${r.score}</span></div>
        <div class="body">
          <div class="bar"><span style="width:${pct}%;background:${r.color}"></span></div>
        </div>
      </div>`;
    }).join('');
  }
  renderRanking();

  // Charts
  window.myCharts = [];
  function drawCharts(){
    if(!window.Chart){ // offline fallback
      $('#radar').replaceWith(Object.assign(document.createElement('div'),{innerHTML:'<em>Chart.js not loaded ‚Äî radar unavailable offline.</em>'}));
      $('#bars').replaceWith(Object.assign(document.createElement('div'),{innerHTML:'<em>Chart.js not loaded ‚Äî bars unavailable offline.</em>'}));
      return;
    }
    const radarCtx = document.getElementById('radar').getContext('2d');
    const barCtx = document.getElementById('bars').getContext('2d');

    const metricsForRadar = METRICS.filter(m=> m.id !== 'shelf');
    const labels = metricsForRadar.map(m=>m.label);
    const ds = key=> metricsForRadar.map(m=>m.scores[key]);

    const styles = getComputedStyle(document.documentElement);
    const textColor = styles.getPropertyValue('--ink').trim();
    const gridColor = styles.getPropertyValue('--line').trim();

    const radar = new Chart(radarCtx, {
      type:'radar',
      data:{ labels, datasets:[
        { label:'Raw', data:ds('raw'), borderColor:brand.maroon, backgroundColor:hexToRgba(brand.maroon,.25)},
        { label:'Sprouted', data:ds('sprouted'), borderColor:brand.gold, backgroundColor:hexToRgba(brand.gold,.25)},
        { label:'Boiled', data:ds('boiled'), borderColor:brand.green, backgroundColor:hexToRgba(brand.green,.25)},
      ]},
      options:{ responsive:true, maintainAspectRatio:false, scales:{ r:{ beginAtZero:true, max:5, angleLines:{color:gridColor}, grid:{color:gridColor}, pointLabels:{color:textColor, font:{size:10}}, ticks:{color:textColor, backdropColor:'transparent'} } }, plugins:{ legend:{labels:{color:textColor}}, tooltip:{enabled:true} } }
    });

    const barData = METRICS.map(m=>({ label:m.label.replace(/\s*\(.*?\)/,''), Raw:m.scores.raw, Sprouted:m.scores.sprouted, Boiled:m.scores.boiled }));

    const bars = new Chart(barCtx, {
      type:'bar',
      data:{
        labels: barData.map(d=>d.label),
        datasets:[
          { label:'Raw', data:barData.map(d=>d.Raw), backgroundColor:brand.maroon },
          { label:'Sprouted', data:barData.map(d=>d.Sprouted), backgroundColor:brand.gold },
          { label:'Boiled', data:barData.map(d=>d.Boiled), backgroundColor:brand.green },
        ]
      },
      options:{
        responsive:true, maintainAspectRatio:false,
        scales:{ x:{ ticks:{ color:textColor, maxRotation:40, minRotation:20, autoSkip:false }, grid:{color:gridColor} }, y:{ beginAtZero:true, max:5, ticks:{ color:textColor }, grid:{color:gridColor} } },
        plugins:{ legend:{labels:{color:textColor}}, tooltip:{enabled:true} }
      }
    });

    // Keep some reasonable height on mobile
    document.getElementById('radar').parentElement.style.height = window.innerWidth < 640 ? '280px' : '360px';
    document.getElementById('bars').parentElement.style.height  = window.innerWidth < 640 ? '320px' : '420px';

    window.myCharts = [radar, bars];
  }
  function hexToRgba(hex, a){ const r=parseInt(hex.slice(1,3),16), g=parseInt(hex.slice(3,5),16), b=parseInt(hex.slice(5,7),16); return `rgba(${r},${g},${b},${a})`; }

  // Redraw charts on resize orientation changes (throttled)
  let rAF = 0;
  window.addEventListener('resize', ()=>{
    if(rAF) cancelAnimationFrame(rAF);
    rAF = requestAnimationFrame(()=>{ if(window.myCharts){ window.myCharts.forEach(c=>c && c.destroy && c.destroy()); } drawCharts(); });
  }, {passive:true});

  // Initial draw
  drawCharts();
  </script>
</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>Plant Protein Alternatives ‚Äî Tamil Nadu Edition (Light)</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
  <style>
    :root {
      --bg: #ffffff;
      --ink: #0F172A; /* slate-900 */
      --muted: #475569; /* slate-600 */
      --line: #E2E8F0; /* slate-200 */
      --hover: #F8FAFC; /* slate-50 */
      --brand: #0ea5e9; /* sky-500 */
      --chip: #e0f2fe; /* sky-100 */
      --chip-active-bg: #7dd3fc;
      --chip-active-border: #38bdf8;
      --radius: 16px;
      --shadow: 0 10px 25px rgba(0,0,0,.07);
    }
    * { box-sizing: border-box; }
    html, body {
      background: var(--bg);
      color: var(--ink);
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
    }
    a { color: var(--brand); }
    .wrap { max-width: 1100px; margin-inline: auto; padding: 16px; }

    /* Banner (image + gradient fallback) */
    .banner {
      position: relative;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      background: linear-gradient(135deg, #e0f2fe, #f0fdf4 60%, #fef9c3);
      min-height: 200px;
    }
    .banner-img {
      width: 100%;
      height: clamp(180px, 28vw, 260px);
      object-fit: cover;
      display: block;
    }
    .banner .title {
      position: absolute; inset: 0;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      text-align: center; color: #072b3a; padding: 24px;
      text-shadow: 0 1px 12px rgba(255,255,255,.7);
    }
    .banner h1 { margin: 0; font-weight: 800; letter-spacing: .2px; font-size: clamp(22px, 3.6vw, 34px); }
    .banner p { margin: .4rem 0 0; font-size: clamp(12px, 1.6vw, 14px); color: #073949; }

    /* Controls */
    .panel { margin-top: 22px; border: 1px solid var(--line); border-radius: var(--radius); box-shadow: var(--shadow); background: #fff; }
    .panel .grid { display: grid; grid-template-columns: 1fr; gap: 16px; padding: 16px; }
    .panel label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 4px; }
    .panel input[type="search"], .panel select {
      width: 100%; border: 1px solid var(--line); border-radius: 10px; padding: 10px 12px;
      outline: none; transition: box-shadow 0.2s;
    }
    .panel input[type="search"]:focus, .panel select:focus { box-shadow: 0 0 0 2px var(--brand); }
    .chiprow { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 6px; }
    .chip { background: var(--chip); border: 1px solid transparent; color: #075985; padding: 6px 10px; border-radius: 999px; font-size: 12px; cursor: pointer; user-select: none; transition: background-color 0.2s; }
    .chip.active { background: var(--chip-active-bg); border-color: var(--chip-active-border); color: #0c4a6e; font-weight: 500; }
    .btnrow { display: flex; gap: 8px; justify-content: flex-end; padding: 10px 16px; border-top: 1px solid var(--line); }
    .btn { border: 1px solid var(--line); background: #fff; color: var(--ink); border-radius: 10px; padding: 9px 12px; font-weight: 600; cursor: pointer; transition: transform 0.1s, background-color 0.2s; }
    .btn.primary { background: var(--brand); color: white; border-color: transparent; }
    .btn:active { transform: translateY(1px); }
    .btn:focus-visible { outline: 2px solid var(--brand); outline-offset: 2px; }

    /* Layout below controls */
    .two-col { display: grid; grid-template-columns: 1fr; gap: 16px; margin-top: 18px; }

    /* Card & Table (Mobile-First) */
    .card { border: 1px solid var(--line); border-radius: var(--radius); background: #fff; box-shadow: var(--shadow); overflow: hidden; }
    .card h3 { margin: 0; padding: 14px 16px; border-bottom: 1px solid var(--line); font-size: 16px; }
    .table-wrap { max-height: 70vh; overflow: auto; content-visibility: auto; contain-intrinsic-size: 600px; }
    table { width: 100%; border-collapse: separate; border-spacing: 0; }
    thead { display: none; } /* Mobile: stacked rows */
    tbody tr { display: block; border-bottom: 1px solid var(--line); padding: 12px 8px; }
    tbody tr:last-child { border-bottom: 0; }
    tbody tr:hover { background: var(--hover); }
    tbody td { display: grid; grid-template-columns: 130px 1fr; gap: 8px; padding: 8px 0; border: none; align-items: center; }
    tbody td::before { content: attr(data-label); font-size: 11px; color: var(--muted); font-weight: 500; }
    td.num { font-weight: 600; }
    .note, .legend { font-size: 12px; color: var(--muted); padding: 10px 16px; }
    .note ul { padding-left: 20px; margin: 0; }
    .note li { margin-bottom: 8px; }

    /* Chart */
    #chartWrap { padding: 12px 12px 18px; }
    .mini-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 12px 10px; }
    .mini-row label { font-size: 12px; color: var(--muted); }

    /* Tablet breakpoint */
    @media (min-width: 640px) {
      .wrap { padding: 24px; }
      .panel .grid { grid-template-columns: 1fr 1fr; }
      .table-wrap { max-height: none; }
      /* Restore standard table layout */
      thead { display: table-header-group; }
      thead th { position: sticky; top: 0; background: var(--bg); border-bottom: 1px solid var(--line); font-size: 12px; text-align: left; color: var(--muted); padding: 10px; }
      tbody tr { display: table-row; padding: 0; }
      tbody td { display: table-cell; grid-template-columns: none; padding: 12px 10px; border-bottom: 1px solid var(--line); vertical-align: middle; }
      tbody td::before { display: none; }
      th.sortable { cursor: pointer; }
      th.sortable .arrow { opacity: .35; margin-left: 6px; }
      th.sortable.active .arrow { opacity: 1; }
    }
    /* Desktop breakpoint */
    @media (min-width: 960px) {
      .panel .grid { grid-template-columns: 1.2fr 1fr 1fr 1fr; }
      .two-col { grid-template-columns: 1.1fr .9fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Banner image: replace banner.jpg with your own image URL -->
    <div class="banner" role="banner" aria-label="Assortment of plant-based protein foods">
      <img
        class="banner-img"
        src="banner.jpg"
        srcset="banner.jpg 1200w"
        sizes="100vw"
        alt="Assortment of plant-based protein foods"
        fetchpriority="high"
        decoding="async"
        onerror="this.remove();" />
      <div class="title">
        <h1>Plant-based Alternatives to Animal Proteins</h1>
        <p>Interactive Data for Tamil Nadu</p>
      </div>
    </div>

    <div class="panel" id="controls">
      <div class="grid">
        <div>
          <label for="q">Search (English)</label>
          <input id="q" type="search" inputmode="search" enterkeyhint="search" autocomplete="off" placeholder="e.g., moong, millet, sundal">
        </div>
        <div>
          <label for="metric">Chart Metric</label>
          <select id="metric">
            <option value="proteinServing">Protein per Serving (Cooked)</option>
            <option value="proteinRaw">Protein per 100 g (Raw)</option>
          </select>
        </div>
        <div>
          <label for="topN">Show Top N in Chart</label>
          <select id="topN">
            <option>5</option><option selected>8</option><option>10</option><option>12</option><option>17</option>
          </select>
        </div>
        <div>
          <label>Categories</label>
          <div class="chiprow" id="cats"></div>
        </div>
      </div>
      <div class="btnrow">
        <button class="btn" id="reset">Reset</button>
        <button class="btn" id="csv">Download CSV</button>
        <button class="btn primary" id="copy">Copy Table</button>
      </div>
    </div>

    <main class="two-col">
      <div class="card">
        <h3>Plant Protein Options (TN Edition)</h3>
        <div class="note">Click headers to sort on desktop. Values are approximate.</div>
        <div class="table-wrap">
          <table id="tbl" aria-live="polite">
            <thead>
              <tr>
                <th class="sortable" data-key="english">English name <span class="arrow">‚Üï</span></th>
                <th class="sortable" data-key="category">Category <span class="arrow">‚Üï</span></th>
                <th class="sortable" data-key="proteinRaw" data-num>Protein per 100 g (raw) <span class="arrow">‚Üï</span></th>
                <th>Serving (typical)</th>
                <th class="sortable" data-key="proteinServing" data-num>Protein per serving (g) <span class="arrow">‚Üï</span></th>
                <th>Typical dishes</th>
                <th>Prep notes</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <h3>Visualization</h3>
        <div class="mini-row">
          <div>
            <label><input type="checkbox" id="fairSrv"> Comparable Servings (‚â•100 g)</label>
          </div>
          <div>
            <label><input type="checkbox" id="showLabels" checked> Show Value Labels</label>
          </div>
        </div>
        <div id="chartWrap">
          <canvas id="bar" height="320" role="img" aria-label="Bar chart showing protein content of selected foods."></canvas>
        </div>
        <div class="legend">Tip: Switch metric to compare raw vs. cooked values. Use category chips to filter.</div>
      </div>
    </main>

    <div class="card" style="margin-top:16px">
      <h3>Quick Notes</h3>
      <div class="note">
        <ul>
          <li><strong>Amino-acid balance:</strong> Combine rice or millets with pulses (idli/dosa, adai, khichdi) for a more complete protein profile.</li>
          <li><strong>Digestion:</strong> Soaking, sprouting, or fermenting lentils can improve digestibility and reduce gas.</li>
          <li><strong>Serving thumb-rules:</strong> 1 bowl cooked dal ‚âà 150 g; 1 bowl cooked grain ‚âà 200 g; a handful of nuts ‚âà 30 g.</li>
          <li><strong>Micronutrients:</strong> Sesame and ragi provide calcium; horse gram and moong provide iron/folate; pumpkin seeds provide zinc.</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function(){
    // Data (English-only)
    const DATA = [
      { english:'Green gram / Moong', category:'Pulse', proteinRaw:24, serving:'150 g bowl', proteinServing:12, dishes:'Moong dal curry, sundal', notes:'Soak and sprout to reduce gas and increase lightness' },
      { english:'Chickpea (Kabuli/Desi)', category:'Pulse', proteinRaw:20, serving:'150 g bowl', proteinServing:13, dishes:'Sundal, salad, chana masala', notes:'Overnight soak; pressure-cook for best texture' },
      { english:'Roasted Bengal Gram (Pottukadalai)', category:'Pulse', proteinRaw:21, serving:'30 g snack', proteinServing:6, dishes:'Pottukadalai with jaggery, chutney powders', notes:'Great snack ‚Äî protein plus fiber' },
      { english:'Black gram / Urad', category:'Pulse', proteinRaw:24, serving:'150 g bowl', proteinServing:12, dishes:'Idli/dosa batter, vadai', notes:'Rice plus urad improves amino-acid balance' },
      { english:'Pigeon pea / Toor dal', category:'Pulse', proteinRaw:22, serving:'150 g bowl', proteinServing:11, dishes:'Sambar', notes:'Well-cooked dal is easier to digest' },
      { english:'Red lentil (Masoor)', category:'Pulse', proteinRaw:24, serving:'150 g bowl', proteinServing:12, dishes:'Masoor dal curry', notes:'Quick-cooking ‚Äî ideal for weeknights' },
      { english:'Horse gram (Kollu)', category:'Pulse', proteinRaw:23, serving:'150 g bowl', proteinServing:13, dishes:'Kollu rasam, podimas', notes:'Sprouting improves taste and lightness' },
      { english:'Cowpea / Black-eyed pea (Karamani)', category:'Pulse', proteinRaw:23.5, serving:'150 g bowl', proteinServing:11.5, dishes:'Karamani sundal, curry', notes:'Soak and cook soft to reduce gas' },
      { english:'Field bean / Hyacinth bean (Mochai)', category:'Pulse', proteinRaw:21, serving:'150 g bowl', proteinServing:12, dishes:'Mochai kuzhambu', notes:'Seasonal ‚Äî fresh beans taste best' },
      { english:'Kidney bean (Rajma)', category:'Pulse', proteinRaw:24, serving:'150 g bowl', proteinServing:13, dishes:'Rajma with rice', notes:'Long soak and thorough cooking are key' },
      { english:'Soy ‚Äî Tofu', category:'Soy Product', proteinRaw:8, serving:'100 g tofu', proteinServing:8, dishes:'Tofu stir-fry, tofu podimas', notes:'Pan-sear or grill for a firmer bite' },
      { english:'Soy ‚Äî TVP (hydrated)', category:'Soy Product', proteinRaw:52, serving:'100 g TVP (hydrated)', proteinServing:16.5, dishes:'TVP mixed curries', notes:'Approx. 52 g per 100 g dry; serving shows hydrated estimate' },
      { english:'Groundnut / Peanut', category:'Nut/Seed', proteinRaw:25.5, serving:'30 g handful', proteinServing:7.5, dishes:'Peanut sundal, chutney', notes:'Calorie-dense ‚Äî watch portions' },
      { english:'Sesame (Ellu)', category:'Nut/Seed', proteinRaw:18, serving:'30 g (2 tbsp)', proteinServing:5.5, dishes:'Ellu podi, laddus', notes:'Calcium-rich; toast before grinding' },
      { english:'Pearl millet (Kambu)', category:'Millet', proteinRaw:11, serving:'200 g bowl', proteinServing:6, dishes:'Kambu koozh, roti', notes:'Pair with pulses to lift protein quality' },
      { english:'Finger millet (Ragi)', category:'Millet', proteinRaw:7.5, serving:'200 g bowl', proteinServing:4.5, dishes:'Ragi kali, dosa', notes:'Sprouting improves iron and calcium bioavailability' },
      { english:'Foxtail/Little millets', category:'Millet', proteinRaw:10, serving:'200 g bowl', proteinServing:5.5, dishes:'Thinai/Saamai pongal', notes:'Millet plus dal balances the amino profile' },
      { english:'Nuts Mix (Almond/Cashew)', category:'Nut/Seed', proteinRaw:19.5, serving:'30 g mix', proteinServing:6, dishes:'Trail mix, powders', notes:'Also provides healthy fats and minerals' },
    ];

    const UI = {
      q: document.getElementById('q'),
      metric: document.getElementById('metric'),
      topN: document.getElementById('topN'),
      fairSrv: document.getElementById('fairSrv'),
      showLabels: document.getElementById('showLabels'),
      cats: document.getElementById('cats'),
      tbody: document.querySelector('#tbl tbody'),
      ctx: document.getElementById('bar').getContext('2d'),
    };

    let sortKey = 'proteinServing', sortDir = 'desc';
    let barChart;
    const catSet = Array.from(new Set(DATA.map(d => d.category)));
    const activeCats = new Set(catSet);

    function matchesQuery(d, q){
      if(!q) return true;
      q = q.toLowerCase();
      return [d.english, d.category, d.dishes, d.notes].some(x => String(x).toLowerCase().includes(q));
    }
    function getFiltered(){
      const q = UI.q.value.trim();
      return DATA.filter(d => activeCats.has(d.category) && matchesQuery(d, q));
    }

    function renderTable(){
      const rows = getFiltered().sort((a,b)=>{
        const A=a[sortKey], B=b[sortKey];
        if(typeof A==='number') return sortDir==='asc'? A-B : B-A;
        return sortDir==='asc'? String(A).localeCompare(String(B)) : String(B).localeCompare(String(A));
      });
      UI.tbody.innerHTML = rows.map(d => (
        '<tr>'+
          '<td data-label="English name">'+d.english+'</td>'+
          '<td data-label="Category">'+d.category+'</td>'+
          '<td data-label="Protein per 100 g (raw)" class="num">'+d.proteinRaw+' g</td>'+
          '<td data-label="Serving (typical)">'+d.serving+'</td>'+
          '<td data-label="Protein per serving" class="num">'+d.proteinServing+' g</td>'+
          '<td data-label="Typical dishes">'+d.dishes+'</td>'+
          '<td data-label="Prep notes">'+d.notes+'</td>'+
        '</tr>'
      )).join('');
    }

    function drawChart(){
      const metric = UI.metric.value;
      const N = parseInt(UI.topN.value,10);
      const fair = UI.fairSrv.checked;
      let rows = getFiltered();

      if(metric==='proteinServing' && fair){
        rows = rows.filter(d => {
          const val = parseInt(d.serving,10);
          return !isNaN(val) ? (val >= 100) : true;
        });
      }

      rows = rows.sort((a,b)=> b[metric]-a[metric]).slice(0,N).reverse();
      const labels = rows.map(d => d.english.split('/')[0].trim());
      const values = rows.map(d => d[metric]);
      const dsLabel = metric==='proteinRaw' ? 'Protein per 100 g (raw)' : 'Protein per Serving (cooked)';

      if(barChart) barChart.destroy();
      barChart = new Chart(UI.ctx, {
        type: 'bar',
        data: { labels, datasets: [{ label: dsLabel, data: values, backgroundColor: 'rgba(14,165,233,0.30)', borderColor: 'rgba(14,165,233,1)', borderWidth: 1.5 }] },
        options: {
          indexAxis: 'y',
          responsive: true, maintainAspectRatio: false,
          scales: {
            x: { ticks: { color: '#0F172A' }, grid: { color: '#E2E8F0' }, beginAtZero: true },
            y: { ticks: { color: '#0F172A' }, grid: { display: false } }
          },
          plugins: {
            legend: { display: false },
            tooltip: { callbacks: { label: function(ctx){ return ctx.raw+' g'; } } }
          },
          animation: {
            duration: 450,
            onComplete: function(){
              if(!UI.showLabels.checked) return;
              const ctx = barChart.ctx;
              const x = barChart.scales.x;
              const y = barChart.scales.y;
              ctx.save();
              ctx.fillStyle = '#0F172A';
              ctx.font = '12px Inter';
              ctx.textAlign = 'left';
              ctx.textBaseline = 'middle';
              values.forEach(function(v,i){
                const yPos = y.getPixelForValue(i);
                const xPos = x.getPixelForValue(v) + 6;
                if(xPos < x.right - 20){ ctx.fillText(v+' g', xPos, yPos); }
              });
              ctx.restore();
            }
          }
        }
      });
    }

    function update(){ renderTable(); drawChart(); }

    // Search debounce
    var t;
    UI.q.addEventListener('input', function(){ clearTimeout(t); t=setTimeout(update, 250); });

    [UI.metric, UI.topN, UI.fairSrv, UI.showLabels].forEach(function(el){ el.addEventListener('change', update); });

    // Sorting (desktop)
    document.querySelectorAll('th.sortable').forEach(function(th){
      th.addEventListener('click', function(){
        var key = th.dataset.key;
        if(sortKey===key){ sortDir = sortDir==='asc' ? 'desc' : 'asc'; }
        else { sortKey = key; sortDir = th.dataset.num ? 'desc' : 'asc'; }
        document.querySelectorAll('th.sortable').forEach(function(x){ x.classList.remove('active'); });
        th.classList.add('active');
        update();
      });
    });

    // CSV + Copy
    function toCSV(rows){
      var headers = ['English name','Category','Protein/100 g raw (g)','Serving','Protein/serving (g)','Typical dishes','Prep notes'];
      var body = rows.map(function(d){ return [d.english,d.category,d.proteinRaw,d.serving,d.proteinServing,d.dishes,d.notes]; });
      function esc(s){ return String(s).split('"').join('""'); }
      return [headers].concat(body).map(function(r){ return r.map(function(x){ return '"'+esc(x)+'"'; }).join(','); }).join('\n');
    }

    document.getElementById('csv').addEventListener('click', function(){
      var blob = new Blob([toCSV(getFiltered())], { type: 'text/csv;charset=utf-8;' });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url; a.download = 'TN-Plant-Proteins-EN.csv';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    document.getElementById('copy').addEventListener('click', function(){
      var tsv = toCSV(getFiltered()).split(',').join('\t').split('"').join('');
      navigator.clipboard.writeText(tsv).then(function(){ alert('Table copied (TSV) to clipboard!'); }).catch(function(){ alert('Copy failed. Your browser may not support this feature.'); });
    });

    // Category chips
    catSet.forEach(function(c){
      var el = document.createElement('span');
      el.className = 'chip active';
      el.textContent = c;
      el.addEventListener('click', function(){
        el.classList.toggle('active');
        if(el.classList.contains('active')) activeCats.add(c); else activeCats.delete(c);
        update();
      });
      UI.cats.appendChild(el);
    });

    // Reset
    document.getElementById('reset').addEventListener('click', function(){
      UI.q.value = '';
      activeCats.clear(); catSet.forEach(function(c){ activeCats.add(c); });
      UI.cats.querySelectorAll('.chip').forEach(function(ch){ ch.classList.add('active'); });
      UI.metric.value = 'proteinServing';
      UI.topN.value = '8';
      UI.fairSrv.checked = false;
      UI.showLabels.checked = true;
      sortKey = 'proteinServing'; sortDir = 'desc';
      update();
    });

    update();
  });
  </script>
</body>
</html>

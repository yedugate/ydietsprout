<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#B9E2C8" />
<title>Y-Diet: Pulses Comparison ‚Äî Single File</title>
<link rel="preload" as="image" href="./ydiet-banner.png" />
<style>
  :root{
    --bg:#ffffff; --ink:#0F172A; --muted:#64748B;
    --panel:#ffffff; --line:#E2E8F0; --hover:#F8FAFC;
    --shadow:0 10px 30px rgba(0,0,0,.08);
    --brand-green:#B9E2C8; --brand-gold:#C8A84E; --brand-maroon:#7A1E1E; --brand-mint:#DFF3E6;
  }
  [data-theme="dark"]{
    --bg:#0b0f14; --ink:#E5EDF7; --muted:#9AA7BC;
    --panel:#0f1622; --line:#1f2a39; --hover:#0d1420;
    --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
    background:var(--bg); color:var(--ink); -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    scroll-behavior:smooth;
  }
  .container{max-width:1120px;margin:0 auto;padding:16px}

  /* Header */
  .banner{position:relative;isolation:isolate}
  .banner::before{content:"";position:absolute;inset:0;z-index:-1;opacity:.30;background:
    radial-gradient(800px 300px at top left, var(--brand-green), transparent),
    radial-gradient(600px 300px at bottom right, var(--brand-gold), transparent);
  }

  /* Hero banner image */
  .hero{margin:12px 0 14px;border-radius:16px;overflow:hidden;border:1px solid var(--line);box-shadow:var(--shadow);background:var(--panel)}
  .hero img{display:block;width:100%;height:auto}
  @media print {.hero{box-shadow:none;border-color:#ccc}}

  h1{margin:6px 0 0;font-size:clamp(22px,5.2vw,36px);line-height:1.15}
  .sub{color:var(--muted)}
  .pills{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .pill{padding:6px 10px;border-radius:999px;font-size:12px;font-weight:600;white-space:nowrap}
  .pill.green{background:color-mix(in srgb, var(--brand-green) 25%, transparent); color:#0b5131;border:1px solid color-mix(in srgb, var(--brand-green) 55%, transparent)}
  .pill.gold{background:color-mix(in srgb, var(--brand-gold) 20%, transparent); color:#5e4b0e;border:1px solid color-mix(in srgb, var(--brand-gold) 50%, transparent)}
  .pill.maroon{background:color-mix(in srgb, var(--brand-maroon) 15%, transparent); color:#4c0f0f;border:1px solid color-mix(in srgb, var(--brand-maroon) 45%, transparent)}

  /* Product cards */
  .cards{display:grid;gap:14px;grid-template-columns:repeat(3,1fr);margin:18px 0}
  @media (max-width:900px){.cards{grid-template-columns:1fr}}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow)}
  .card .head{padding:14px 16px;border-bottom:1px solid var(--line)}
  .card .body{padding:14px 16px}
  .card h3{margin:0;font-size:16px}
  .emoji{font-size:22px;margin-right:8px}
  .subtitle{font-size:12px;color:var(--muted)}

  /* Tabs */
  .tabs{display:grid;gap:8px}
  .tab-list{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;position:sticky;top:0;background:var(--bg);padding-top:8px;z-index:5}
  /* Mobile: horizontal scroll for tabs */
  @media (max-width:640px){
    .tab-list{display:flex;overflow-x:auto;-webkit-overflow-scrolling:touch;gap:8px;padding-bottom:4px}
    .tab-list::-webkit-scrollbar{display:none}
  }
  .tab-list button{
    padding:12px;border-radius:12px;border:1px solid var(--line);background:var(--panel);cursor:pointer;font-weight:600;
    min-height:44px; touch-action:manipulation; -webkit-tap-highlight-color:transparent;
  }
  .tab-list button[aria-selected="true"]{outline:2px solid var(--brand-gold);}
  .tab-panel{display:none}
  .tab-panel.active{display:block}

  /* Controls */
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  .btn{padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:var(--panel);cursor:pointer;min-height:44px}
  .btn.primary{border-color:color-mix(in srgb, var(--brand-green) 40%, var(--line)); background:linear-gradient(180deg, color-mix(in srgb, var(--brand-green) 18%, #fff), var(--panel))}
  .btn:active{transform:scale(.985)}
  .btn:hover{background:var(--hover)}
  .spacer{flex:1}
  .input{background:var(--panel);border:1px solid var(--line);padding:10px 12px;border-radius:10px;min-width:240px;color:inherit}

  /* Table */
  .table-wrap{overflow:auto;-webkit-overflow-scrolling:touch}
  table{width:100%;border-collapse:separate;border-spacing:0}
  thead th{position:sticky;top:0;background:var(--panel);z-index:1}
  th,td{padding:12px 10px;border-bottom:1px solid var(--line);vertical-align:top;white-space:normal}
  tbody tr:hover{background:var(--hover)}
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid; font-weight:700;font-size:12px}

  /* Grid helpers */
  .grid{display:grid;gap:12px}
  .grid-2{grid-template-columns:repeat(2,1fr)}
  @media (max-width:900px){.grid-2{grid-template-columns:1fr}}

  /* Sliders */
  .weight-row{display:grid;grid-template-columns:140px 1fr 64px;gap:8px;align-items:center}
  input[type="range"]{width:100%}

  /* Progress */
  .bar{height:8px;background:var(--line);border-radius:8px;overflow:hidden}
  .bar > span{display:block;height:100%}

  /* Notes */
  .notes{padding:12px 16px;border:1px dashed var(--line);border-radius:12px;background:var(--hover);color:var(--ink)}

  .footer{margin:18px 0 36px;color:var(--muted);text-align:center;font-size:12px}

  /* MOBILE TUNING */
  @media (max-width:640px){
    .container{padding:12px}
    h1{font-size:clamp(20px,6vw,28px)}
    .toolbar .btn{flex:1 1 calc(50% - 8px)}
    .input{min-width:0;width:100%}
    .weight-row{grid-template-columns:1fr;gap:6px}
    table{font-size:14px}
  }
  @media (prefers-reduced-motion:reduce){
    *{animation:none!important;transition:none!important}
  }
</style>
</head>
<body>
  <div class="container">
    <!-- Banner -->
    <section class="banner">
      <!-- HERO IMAGE (local file in the same folder) -->
      <figure class="hero">
        <img
          src="./ydiet-banner.png"
          srcset="./ydiet-banner.png 1120w, ./ydiet-banner.png 1600w"
          sizes="(max-width:680px) 100vw, 1120px"
          alt="Y-Diet banner ‚Äî Raw, Sprouted, Boiled Sprouted moong with Y-leaf logo"
          width="1600" height="700" loading="eager" decoding="async" fetchpriority="high">
      </figure>

      <h1>Y-Diet: Pulses Comparison</h1>
      <p class="sub">Raw vs Sprouted vs Boiled Sprouted ‚Äî interactive, visual, and printable. Assume <strong>moong/mung</strong> unless noted.</p>
      <div class="pills">
        <span class="pill green">Clean-Label</span>
        <span class="pill gold">Synergy-First</span>
        <span class="pill maroon">Feel Light</span>
      </div>
      <div class="toolbar" style="margin-top:12px">
        <button id="printBtn" class="btn">üñ®Ô∏è Print</button>
        <button id="csvBtn" class="btn">‚¨áÔ∏è Export CSV</button>
        <span class="spacer"></span>
        <button id="themeBtn" class="btn">üåô Dark mode</button>
      </div>
    </section>

    <!-- Product Cards -->
    <section class="cards" id="productCards"></section>

    <!-- Tabs -->
    <section class="tabs">
      <div class="tab-list" role="tablist">
        <button class="tab-btn" role="tab" aria-selected="true" data-tab="visualize">Visualize</button>
        <button class="tab-btn" role="tab" aria-selected="false" data-tab="table">Table</button>
        <button class="tab-btn" role="tab" aria-selected="false" data-tab="rank">Your Ranking</button>
      </div>

      <!-- Visualize Panel -->
      <div id="panel-visualize" class="tab-panel active">
        <div class="grid grid-2" style="margin-top:12px">
          <div class="card">
            <div class="head"><h3 style="margin:0">Radar: Overall Profile</h3></div>
            <div class="body"><canvas id="radar"></canvas></div>
          </div>
          <div class="card">
            <div class="head"><h3 style="margin:0">Bars: Aspect-by-Aspect</h3></div>
            <div class="body"><canvas id="bars"></canvas></div>
          </div>
        </div>
        <div class="notes" style="margin-top:12px">
          <strong>Notes & Tips:</strong>
          <ul>
            <li>For most people, <strong>boiled sprouted moong</strong> ‚Üí least gas, most lightness, best taste.</li>
            <li>Reduce gas further with <strong>ginger, asafoetida (hing), cumin, lemon</strong>, and thorough rinsing.</li>
            <li><strong>Safety:</strong> Avoid eating raw kidney beans/soy/black gram; cook thoroughly. Keep sprouting gear clean and refrigerate sprouts; use within <strong>1‚Äì2 days</strong>.</li>
          </ul>
        </div>
      </div>

      <!-- Table Panel -->
      <div id="panel-table" class="tab-panel">
        <div class="card" style="margin-top:12px">
          <div class="head" style="display:flex;gap:8px;align-items:center">
            <h3 style="margin:0">Comparative Table</h3>
            <span class="spacer"></span>
            <input id="filterInput" class="input" placeholder="Filter aspects‚Ä¶"/>
          </div>
          <div class="body table-wrap">
            <table id="compTable"></table>
          </div>
        </div>
        <div class="notes" style="margin-top:12px">
          Scores are on a 1‚Äì5 scale for visualization; higher is better. Labels like ‚ÄúLower = Better‚Äù are pre-inverted.
        </div>
      </div>

      <!-- Rank Panel -->
      <div id="panel-rank" class="tab-panel">
        <div class="card" style="margin-top:12px">
          <div class="head"><h3 style="margin:0">Custom Ranking</h3></div>
          <div class="body grid" id="weightsPanel"></div>
        </div>
        <div class="card" style="margin-top:12px">
          <div class="head"><h3 style="margin:0">Your Results</h3></div>
          <div class="body grid" id="rankResults"></div>
        </div>
        <div class="notes" style="margin-top:12px">
          Adjust the sliders. Scores are auto-normalized by the total weight.
        </div>
      </div>
    </section>

    <div class="footer">¬© <span id="year"></span> Y-Diet ‚Ä¢ Observe ‚Üí Adjust ‚Üí Absorb ‚Üí Evolve</div>
  </div>

  <!-- Chart.js (CDN). If offline, the charts won't render; page still works. -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
  // ===== Data =====
  const brand = { green:'#B9E2C8', gold:'#C8A84E', maroon:'#7A1E1E', ink:'#0F172A', mint:'#DFF3E6' };
  const PRODUCTS = [
    { key:'raw', name:'Raw Pulses', subtitle:'dry/soaked, uncooked', color:brand.maroon, emoji:'üå±' },
    { key:'sprouted', name:'Sprouted Pulses', subtitle:'uncooked sprouts', color:brand.gold, emoji:'üåø' },
    { key:'boiled', name:'Boiled Sprouted Pulses', subtitle:'lightly cooked sprouts', color:brand.green, emoji:'üç≤' },
  ];
  const METRICS = [
    { id:'lightness', label:'Digestibility / Lightness', desc:{raw:'Low (hard on gut)', sprouted:'Medium‚ÄìHigh', boiled:'High (gentle)'}, scores:{raw:1, sprouted:4, boiled:5}},
    { id:'gas', label:'Comfort (Lower Gas = Better)', desc:{raw:'High gas ‚Üí low comfort', sprouted:'Medium gas', boiled:'Low gas ‚Üí high comfort'}, scores:{raw:1, sprouted:3, boiled:5}},
    { id:'taste', label:'Taste Satisfaction', desc:{raw:'Beany, chewy', sprouted:'Fresh, crunchy, grassy', boiled:'Warm, soft, mildly sweet‚Äìnutty'}, scores:{raw:2, sprouted:3.5, boiled:4.5}},
    { id:'antiNutrients', label:'Anti-Nutrients (Lower = Better)', desc:{raw:'Highest', sprouted:'Lower', boiled:'Lowest'}, scores:{raw:1, sprouted:3, boiled:5}},
    { id:'bioavailability', label:'Protein & Mineral Bioavailability', desc:{raw:'Lowest', sprouted:'Improved', boiled:'Best among three'}, scores:{raw:1.5, sprouted:3.5, boiled:5}},
    { id:'vitamins', label:'Vitamins / Enzymes', desc:{raw:'Baseline', sprouted:'‚Üë Some vitamins & enzymes', boiled:'Some heat loss; access still better'}, scores:{raw:2, sprouted:4, boiled:3.5}},
    { id:'glycemic', label:'Glycemic Impact (Lower = Better)', desc:{raw:'Moderate', sprouted:'Lower vs raw', boiled:'Lower‚Äìmoderate'}, scores:{raw:3, sprouted:4, boiled:3.5}},
    { id:'safety', label:'Food-Safety Confidence', desc:{raw:'Higher risk if eaten raw', sprouted:'Needs clean sprouting', boiled:'Safest when cooked'}, scores:{raw:1.5, sprouted:3, boiled:5}},
    { id:'shelf', label:'Shelf Life After Prep', desc:{raw:'Soaked < 24h chilled', sprouted:'1‚Äì2 days chilled (rinse daily)', boiled:'1‚Äì2 days chilled'}, scores:{raw:2, sprouted:3, boiled:3}},
  ];

  // ===== Helpers =====
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  $('#year').textContent = new Date().getFullYear();

  // Theme: load from storage or system preference
  const themeBtn = $('#themeBtn');
  let dark = (localStorage.getItem('ydiet-theme') ??
             (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'true':'false')) === 'true';
  function setTheme(){
    document.documentElement.setAttribute('data-theme', dark? 'dark' : 'light');
    themeBtn.textContent = dark? '‚òÄÔ∏è Light mode' : 'üåô Dark mode';
    localStorage.setItem('ydiet-theme', String(dark));
    // Repaint charts to match theme colors
    if(window.myCharts) window.myCharts.forEach(c=>c && c.destroy && c.destroy());
    drawCharts();
  }
  themeBtn.addEventListener('click', ()=>{ dark = !dark; setTheme(); });
  setTheme();

  // Product cards
  $('#productCards').innerHTML = PRODUCTS.map(p=>`
    <div class="card">
      <div class="head"><h3><span class="emoji" aria-hidden="true">${p.emoji}</span><span style="color:${p.color}">${p.name}</span></h3></div>
      <div class="body"><span class="subtitle">${p.subtitle}</span></div>
    </div>
  `).join('');

  // Tabs
  const tabs = $$('.tab-btn');
  function showTab(key){
    tabs.forEach(b=>b.setAttribute('aria-selected', String(b.dataset.tab===key)));
    $$('.tab-panel').forEach(p=>p.classList.toggle('active', p.id === `panel-${key}`));
  }
  tabs.forEach(b=>b.addEventListener('click', ()=>showTab(b.dataset.tab)));

  // Table
  const compTable = $('#compTable');
  function renderTable(filter=''){
    const head = `
      <thead>
        <tr>
          <th>Aspect</th>
          ${PRODUCTS.map(p=>`<th style="color:${p.color}">${p.name}</th>`).join('')}
        </tr>
      </thead>`;
    const rows = METRICS
      .filter(m=> m.label.toLowerCase().includes(filter.toLowerCase()))
      .map((m,i)=>{
        return `<tr class="${i%2? 'alt':''}">
          <td><strong>${m.label}</strong></td>
          ${PRODUCTS.map(p=>{
            const val = m.scores[p.key];
            const color = p.color;
            return `<td>
              <span class="badge" style="border-color:${color}; color:${color}">${val}</span>
              <span style="margin-left:8px;color:var(--muted)">${m.desc[p.key]}</span>
            </td>`;
          }).join('')}
        </tr>`;
      }).join('');
    compTable.innerHTML = head + `<tbody>${rows}</tbody>`;
  }
  renderTable('');
  $('#filterInput')?.addEventListener('input', e=>renderTable(e.target.value));

  // CSV export (visible rows only)
  function toCSV(){
    const rows = Array.from(compTable.querySelectorAll('tr'));
    return rows.map(r=> Array.from(r.children).map(c=> '"'+c.innerText.replaceAll('\n',' ').replaceAll('"','""')+'"').join(',')).join('\n');
  }
  $('#csvBtn').addEventListener('click', ()=>{
    const csv = toCSV();
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='pulses_comparison_moong.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });
  $('#printBtn').addEventListener('click', ()=>window.print());

  // Ranking weights panel
  const weightDefaults = { lightness:.4, gas:.3, taste:.2, safety:.1 };
  let weights = {...weightDefaults};
  const weightsPanel = $('#weightsPanel');
  const sliders = [
    { id:'lightness', label:'Weight: Lightness' },
    { id:'gas', label:'Weight: Comfort (Low Gas)' },
    { id:'taste', label:'Weight: Taste' },
    { id:'safety', label:'Weight: Food-Safety' },
  ];
  function renderWeights(){
    weightsPanel.innerHTML = sliders.map(s=>{
      const pct = Math.round((weights[s.id]||0)*100);
      return `<div class="weight-row">
        <label for="w_${s.id}">${s.label}</label>
        <input type="range" min="0" max="100" step="1" id="w_${s.id}" value="${pct}" />
        <div style="text-align:right;color:var(--muted)">${pct}%</div>
      </div>`;
    }).join('') + `<div style="color:var(--muted);font-size:12px">Total: ${(Object.values(weights).reduce((a,b)=>a+b,0)*100).toFixed(0)}% (auto-normalized)</div>`;

    sliders.forEach(s=>{
      const el = document.getElementById('w_'+s.id);
      el.addEventListener('input', (e)=>{ weights[s.id] = +e.target.value/100; renderWeights(); renderRanking(); });
    });
  }
  renderWeights();

  // Ranking computation
  const rankResults = $('#rankResults');
  function renderRanking(){
    const sumW = Object.values(weights).reduce((a,b)=>a+b,0) || 1;
    const list = PRODUCTS.map(p=>{
      const score = METRICS.reduce((acc,m)=>{ const w = weights[m.id] || 0; return acc + (m.scores[p.key]*w); },0) / sumW;
      return { key:p.key, name:p.name, color:p.color, score: +score.toFixed(2) };
    }).sort((a,b)=>b.score-a.score);

    rankResults.innerHTML = list.map((r,i)=>{
      const pct = (r.score/5)*100;
      return `<div class="card">
        <div class="head" style="display:flex;align-items:center;justify-content:space-between"><strong>${i+1}. ${r.name}</strong><span class="badge" style="border-color:${r.color}; color:${r.color}">${r.score}</span></div>
        <div class="body">
          <div class="bar"><span style="width:${pct}%;background:${r.color}"></span></div>
        </div>
      </div>`;
    }).join('');
  }
  renderRanking();

  // Charts
  window.myCharts = [];
  function drawCharts(){
    if(!window.Chart){ // offline fallback
      $('#radar').replaceWith(Object.assign(document.createElement('div'),{innerHTML:'<em>Chart.js not loaded ‚Äî radar unavailable offline.</em>'}));
      $('#bars').replaceWith(Object.assign(document.createElement('div'),{innerHTML:'<em>Chart.js not loaded ‚Äî bars unavailable offline.</em>'}));
      return;
    }
    const radarCtx = document.getElementById('radar').getContext('2d');
    const barCtx = document.getElementById('bars').getContext('2d');

    const metricsForRadar = METRICS.filter(m=> m.id !== 'shelf');
    const labels = metricsForRadar.map(m=>m.label);
    const ds = key=> metricsForRadar.map(m=>m.scores[key]);

    const styles = getComputedStyle(document.documentElement);
    const textColor = styles.getPropertyValue('--ink').trim();
    const gridColor = styles.getPropertyValue('--line').trim();

    const radar = new Chart(radarCtx, {
      type:'radar',
      data:{ labels, datasets:[
        { label:'Raw', data:ds('raw'), borderColor:brand.maroon, backgroundColor:hexToRgba(brand.maroon,.25)},
        { label:'Sprouted', data:ds('sprouted'), borderColor:brand.gold, backgroundColor:hexToRgba(brand.gold,.25)},
        { label:'Boiled', data:ds('boiled'), borderColor:brand.green, backgroundColor:hexToRgba(brand.green,.25)},
      ]},
      options:{ responsive:true, maintainAspectRatio:false, scales:{ r:{ beginAtZero:true, max:5, angleLines:{color:gridColor}, grid:{color:gridColor}, pointLabels:{color:textColor, font:{size:10}}, ticks:{color:textColor, backdropColor:'transparent'} } }, plugins:{ legend:{labels:{color:textColor}}, tooltip:{enabled:true} } }
    });

    const barData = METRICS.map(m=>({ label:m.label.replace(/\s*\(.*?\)/,''), Raw:m.scores.raw, Sprouted:m.scores.sprouted, Boiled:m.scores.boiled }));

    const bars = new Chart(barCtx, {
      type:'bar',
      data:{
        labels: barData.map(d=>d.label),
        datasets:[
          { label:'Raw', data:barData.map(d=>d.Raw), backgroundColor:brand.maroon },
          { label:'Sprouted', data:barData.map(d=>d.Sprouted), backgroundColor:brand.gold },
          { label:'Boiled', data:barData.map(d=>d.Boiled), backgroundColor:brand.green },
        ]
      },
      options:{
        responsive:true, maintainAspectRatio:false,
        scales:{ x:{ ticks:{ color:textColor, maxRotation:40, minRotation:20, autoSkip:false }, grid:{color:gridColor} }, y:{ beginAtZero:true, max:5, ticks:{ color:textColor }, grid:{color:gridColor} } },
        plugins:{ legend:{labels:{color:textColor}}, tooltip:{enabled:true} }
      }
    });

    // Keep some reasonable height on mobile
    document.getElementById('radar').parentElement.style.height = window.innerWidth < 640 ? '280px' : '360px';
    document.getElementById('bars').parentElement.style.height  = window.innerWidth < 640 ? '320px' : '420px';

    window.myCharts = [radar, bars];
  }
  function hexToRgba(hex, a){ const r=parseInt(hex.slice(1,3),16), g=parseInt(hex.slice(3,5),16), b=parseInt(hex.slice(5,7),16); return `rgba(${r},${g},${b},${a})`; }

  // Redraw charts on resize orientation changes (throttled)
  let rAF = 0;
  window.addEventListener('resize', ()=>{
    if(rAF) cancelAnimationFrame(rAF);
    rAF = requestAnimationFrame(()=>{ if(window.myCharts){ window.myCharts.forEach(c=>c && c.destroy && c.destroy()); } drawCharts(); });
  }, {passive:true});

  // Initial draw
  drawCharts();
  </script>
</body>
</html>

